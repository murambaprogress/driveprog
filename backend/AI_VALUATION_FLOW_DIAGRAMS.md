# AI Car Valuation System - Visual Flow Diagram

## Complete Process Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER WORKFLOW                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 1: Application Creation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User       â”‚â”€â”€> Creates loan application (draft)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    Fills in personal & loan details

Step 2: Vehicle Image Upload
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User       â”‚â”€â”€> Uploads 3-5 vehicle images
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    (Front, Side, Rear, Interior)
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    BACKEND PROCESSING                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Step 3: API Endpoint
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  POST /api/loans/applications/ â”‚
â”‚  {id}/analyze_vehicle/         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€> Validate user permissions
       â”œâ”€â”€> Save images as LoanApplicationDocument
       â”‚
       â–¼
Step 4: Image Analysis
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CarImageAnalyzer             â”‚
â”‚                                â”‚
â”‚   For each image:              â”‚
â”‚   1. Encode to base64          â”‚
â”‚   2. Send to GPT-4 Vision      â”‚
â”‚   3. Extract vehicle details   â”‚
â”‚   4. Identify damage           â”‚
â”‚   5. List features             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 5: Result Aggregation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Combine Multiple Analyses    â”‚
â”‚                                â”‚
â”‚   â€¢ Verify make/model/year     â”‚
â”‚   â€¢ Consolidate damage list    â”‚
â”‚   â€¢ Merge feature lists        â”‚
â”‚   â€¢ Determine overall conditionâ”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 6: Market Valuation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GPT-4 Market Query           â”‚
â”‚                                â”‚
â”‚   Query: "What is value of     â”‚
â”‚   2020 Toyota Camry in good    â”‚
â”‚   condition?"                  â”‚
â”‚                                â”‚
â”‚   Response:                    â”‚
â”‚   â€¢ Low estimate: $18,500      â”‚
â”‚   â€¢ High estimate: $22,000     â”‚
â”‚   â€¢ Average: $20,250           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 7: Loan Assessment
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CarValuationService          â”‚
â”‚                                â”‚
â”‚   Calculate LTV Ratio:         â”‚
â”‚   LTV = (Loan / Value) Ã— 100   â”‚
â”‚                                â”‚
â”‚   Example:                     â”‚
â”‚   $15,000 / $20,250 = 74.07%  â”‚
â”‚                                â”‚
â”‚   Apply Condition Multiplier:  â”‚
â”‚   Good = 80% of value          â”‚
â”‚   Max Loan = $16,200          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 8: Risk Assessment
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Determine Risk Level         â”‚
â”‚                                â”‚
â”‚   LTV < 70%    â†’ Low Risk      â”‚
â”‚   LTV 70-85%   â†’ Medium Risk   â”‚
â”‚   LTV > 85%    â†’ High Risk     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 9: Approval Decision
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Decision Matrix              â”‚
â”‚                                â”‚
â”‚   LTV â‰¤ 80%    â†’ âœ… APPROVED   â”‚
â”‚   LTV 81-90%   â†’ âš ï¸ CONDITIONALâ”‚
â”‚   LTV > 90%    â†’ âŒ DENIED     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 10: Save Results
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Create VehicleValuation      â”‚
â”‚                                â”‚
â”‚   Store:                       â”‚
â”‚   â€¢ Vehicle details            â”‚
â”‚   â€¢ Condition assessment       â”‚
â”‚   â€¢ Value estimates            â”‚
â”‚   â€¢ LTV ratio                  â”‚
â”‚   â€¢ Max loan amount            â”‚
â”‚   â€¢ Risk level                 â”‚
â”‚   â€¢ Approval decision          â”‚
â”‚   â€¢ Full analysis data         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
Step 11: Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   JSON Response to Frontend    â”‚
â”‚                                â”‚
â”‚   {                            â”‚
â”‚     "success": true,           â”‚
â”‚     "analysis": {              â”‚
â”‚       "vehicle": {...},        â”‚
â”‚       "valuation": {...},      â”‚
â”‚       "loan_assessment": {...},â”‚
â”‚       "risk": {...}            â”‚
â”‚     }                          â”‚
â”‚   }                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        USER SEES RESULTS                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Display to User:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Your Vehicle Analysis        â”‚
â”‚                                â”‚
â”‚   ğŸš— 2020 Toyota Camry         â”‚
â”‚   ğŸ’µ Estimated Value: $20,250  â”‚
â”‚   ğŸ“Š LTV Ratio: 74.07%        â”‚
â”‚   âœ… LOAN APPROVED            â”‚
â”‚   ğŸ’° Max Loan: $16,200        â”‚
â”‚   ğŸ¯ Recommended: $14,175     â”‚
â”‚   âš ï¸  Risk Level: Low          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## Data Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Frontendâ”‚â”€â”€â”€â”€>â”‚   Django     â”‚â”€â”€â”€â”€>â”‚   CarImage     â”‚â”€â”€â”€â”€>â”‚  OpenAI  â”‚
â”‚         â”‚     â”‚   Endpoint   â”‚     â”‚   Analyzer     â”‚     â”‚    API   â”‚
â”‚ (Images)â”‚     â”‚              â”‚     â”‚                â”‚     â”‚(GPT-4)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                      â”‚                    â”‚
                       â”‚                      â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                      â”‚  (Analysis Results)
                       â”‚                      â”‚
                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚              â”‚ CarValuation   â”‚
                       â”‚              â”‚    Service     â”‚
                       â”‚              â”‚                â”‚
                       â”‚              â”‚ â€¢ Calculates   â”‚
                       â”‚              â”‚   LTV          â”‚
                       â”‚              â”‚ â€¢ Assesses     â”‚
                       â”‚              â”‚   Risk         â”‚
                       â”‚              â”‚ â€¢ Makes        â”‚
                       â”‚              â”‚   Decision     â”‚
                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                       â”‚
                       â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                       â”‚              â”‚   VehicleValuation â”‚
                       â”‚              â”‚   (Database Model) â”‚
                       â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚                       â”‚
                       â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚  (Complete Analysis)
                       â”‚
                       â–¼
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚  JSON    â”‚
                 â”‚ Response â”‚
                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Component Interaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     SYSTEM COMPONENTS                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LoanApplication    â”‚
â”‚  (Main Model)       â”‚
â”‚  â€¢ User info        â”‚
â”‚  â€¢ Loan details     â”‚
â”‚  â€¢ Vehicle basic    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ has_many
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ LoanApplication     â”‚
â”‚ Document            â”‚
â”‚ â€¢ Images            â”‚
â”‚ â€¢ Analysis results  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ triggers
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CarImageAnalyzer   â”‚
â”‚  â€¢ Image encoding   â”‚
â”‚  â€¢ GPT-4 Vision API â”‚
â”‚  â€¢ Detail extractionâ”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ uses
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ CarValuationService â”‚
â”‚ â€¢ Market pricing    â”‚
â”‚ â€¢ LTV calculation   â”‚
â”‚ â€¢ Risk assessment   â”‚
â”‚ â€¢ Decision logic    â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ creates
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  VehicleValuation   â”‚
â”‚  â€¢ Complete results â”‚
â”‚  â€¢ Approval status  â”‚
â”‚  â€¢ Risk metrics     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Decision Tree

```
                    Start: Vehicle Images Uploaded
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Analyze Images  â”‚
                      â”‚  (GPT-4 Vision) â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Extract Details â”‚
                      â”‚ Make/Model/Year â”‚
                      â”‚   Condition     â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Get Market      â”‚
                      â”‚ Valuation       â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                      â”‚ Calculate LTV   â”‚
                      â”‚ Loan / Value    â”‚
                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                 â”‚             â”‚             â”‚
                 â–¼             â–¼             â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ LTV â‰¤80% â”‚  â”‚ LTV 81-90%â”‚  â”‚ LTV >90% â”‚
          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
               â”‚             â”‚             â”‚
               â–¼             â–¼             â–¼
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚ âœ… APPROVEâ”‚  â”‚âš ï¸ PENDING â”‚  â”‚ âŒ DENY  â”‚
          â”‚          â”‚  â”‚          â”‚  â”‚          â”‚
          â”‚ Process  â”‚  â”‚ Request  â”‚  â”‚ Reduce   â”‚
          â”‚ Loan     â”‚  â”‚ More Docsâ”‚  â”‚ Amount   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## State Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              VEHICLE VALUATION STATES                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   [No Images]
        â”‚
        â”‚ Upload Images
        â–¼
   [Images Uploaded]
        â”‚
        â”‚ Trigger Analysis
        â–¼
   [Analyzing...]
        â”‚
        â”œâ”€â”€> [Analysis Failed] â”€â”€> Retry / Manual Review
        â”‚
        â”‚ Success
        â–¼
   [Analyzed]
        â”‚
        â”‚ LTV Calculation
        â–¼
   [Assessed]
        â”‚
        â”œâ”€â”€> [Low Risk] â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€> [APPROVED]
        â”‚
        â”œâ”€â”€> [Medium Risk] â”€â”€â”€â”€â”€â”€â”€> [CONDITIONAL]
        â”‚
        â””â”€â”€> [High Risk] â”€â”€â”€â”€â”€â”€â”€â”€â”€> [DENIED]
                                          â”‚
                                          â”‚ Manual Override
                                          â–¼
                                    [Override Applied]
```

---

## Timeline Flow

```
TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>

T=0s    â”‚ User uploads images
        â”‚
T=1s    â”‚ API receives request
        â”‚ Saves images to storage
        â”‚
T=2s    â”‚ Encodes images to base64
        â”‚
T=3s    â”‚ Sends first image to GPT-4 Vision
        â”‚
T=8s    â”‚ â—€â”€â”€ Receives first analysis
        â”‚
T=9s    â”‚ Sends second image to GPT-4 Vision
        â”‚
T=14s   â”‚ â—€â”€â”€ Receives second analysis
        â”‚
T=15s   â”‚ Sends third image to GPT-4 Vision
        â”‚
T=20s   â”‚ â—€â”€â”€ Receives third analysis
        â”‚
T=21s   â”‚ Aggregates results
        â”‚
T=22s   â”‚ Queries GPT-4 for market pricing
        â”‚
T=26s   â”‚ â—€â”€â”€ Receives market valuation
        â”‚
T=27s   â”‚ Calculates LTV ratio
        â”‚ Applies condition multiplier
        â”‚ Assesses risk
        â”‚ Makes approval decision
        â”‚
T=28s   â”‚ Creates VehicleValuation record
        â”‚ Updates LoanApplication
        â”‚
T=29s   â”‚ Returns JSON response
        â”‚
T=30s   â”‚ Frontend displays results

Total Time: ~30 seconds for 3 images
```

---

## Error Handling Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  User Action        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Validation         â”‚
â”‚  â€¢ Auth check       â”‚
â”‚  â€¢ Image format     â”‚
â”‚  â€¢ File size        â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€> Error â”€â”€> Return 400/401/403
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Image Processing   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€> Encoding Error â”€â”€> Return 500
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GPT-4 API Call     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€> API Key Error â”€â”€> Return 500 + Config Error
       â”œâ”€> Timeout â”€â”€> Retry (3x) â”€â”€> Return 500
       â”œâ”€> Rate Limit â”€â”€> Return 429 + Retry After
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Result Processing  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€> Parse Error â”€â”€> Log + Manual Review Flag
       â”œâ”€> Low Confidence â”€â”€> Flag for Review
       â”‚
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Success Response   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Database Schema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DATABASE TABLES                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

LoanApplication
â”œâ”€â”€ id (PK)
â”œâ”€â”€ application_id (UUID)
â”œâ”€â”€ user_id (FK â†’ User)
â”œâ”€â”€ vehicle_make
â”œâ”€â”€ vehicle_model
â”œâ”€â”€ vehicle_year
â”œâ”€â”€ loan_amount
â””â”€â”€ ... (other fields)
     â”‚
     â”‚ One-to-Many
     â–¼
LoanApplicationDocument
â”œâ”€â”€ id (PK)
â”œâ”€â”€ application_id (FK)
â”œâ”€â”€ document_type ('vehicle_image')
â”œâ”€â”€ file (ImageField)
â”œâ”€â”€ ai_analysis_result (JSON)
â””â”€â”€ is_analyzed (Boolean)
     â”‚
     â”‚ One-to-One
     â–¼
VehicleValuation
â”œâ”€â”€ id (PK)
â”œâ”€â”€ application_id (FK, Unique)
â”œâ”€â”€ make
â”œâ”€â”€ model
â”œâ”€â”€ year
â”œâ”€â”€ condition
â”œâ”€â”€ visible_damage (JSON)
â”œâ”€â”€ features (JSON)
â”œâ”€â”€ estimated_value_low
â”œâ”€â”€ estimated_value_high
â”œâ”€â”€ estimated_value_avg
â”œâ”€â”€ ltv_ratio
â”œâ”€â”€ max_loan_amount
â”œâ”€â”€ recommended_loan_amount
â”œâ”€â”€ risk_level
â”œâ”€â”€ risk_factors (JSON)
â”œâ”€â”€ is_approved_for_loan
â”œâ”€â”€ approval_notes
â”œâ”€â”€ confidence_level
â”œâ”€â”€ images_analyzed
â”œâ”€â”€ full_analysis_data (JSON)
â””â”€â”€ analyzed_at
```

---

## API Request/Response Flow

```
REQUEST:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST /api/loans/applications/123/analyze_vehicle/  â”‚
â”‚                                                     â”‚
â”‚ Headers:                                            â”‚
â”‚   Authorization: Bearer {token}                     â”‚
â”‚   Content-Type: multipart/form-data                 â”‚
â”‚                                                     â”‚
â”‚ Body:                                               â”‚
â”‚   images: [File, File, File]                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â–¼
                  [PROCESSING]
                        â”‚
                        â–¼
RESPONSE:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ HTTP 200 OK                                         â”‚
â”‚                                                     â”‚
â”‚ {                                                   â”‚
â”‚   "success": true,                                  â”‚
â”‚   "message": "Vehicle analysis completed",          â”‚
â”‚   "analysis": {                                     â”‚
â”‚     "vehicle": {                                    â”‚
â”‚       "make": "Toyota",                             â”‚
â”‚       "model": "Camry",                             â”‚
â”‚       "year": "2020"                                â”‚
â”‚     },                                              â”‚
â”‚     "valuation": {                                  â”‚
â”‚       "estimated_average": "20250.00"               â”‚
â”‚     },                                              â”‚
â”‚     "loan_assessment": {                            â”‚
â”‚       "ltv_ratio": "74.07",                         â”‚
â”‚       "is_approved": true                           â”‚
â”‚     }                                               â”‚
â”‚   }                                                 â”‚
â”‚ }                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Admin Workflow

```
Admin Login â”€â”€> Django Admin Dashboard
                       â”‚
                       â–¼
              Loans â†’ Vehicle Valuations
                       â”‚
                       â”œâ”€â”€> View All Valuations
                       â”‚    â€¢ Filter by risk/condition
                       â”‚    â€¢ Search by make/model
                       â”‚    â€¢ Sort by value/date
                       â”‚
                       â”œâ”€â”€> Select Valuation
                       â”‚    â€¢ View vehicle details
                       â”‚    â€¢ See approval status
                       â”‚    â€¢ Check risk metrics
                       â”‚    â€¢ Review full analysis
                       â”‚
                       â””â”€â”€> Manual Override
                            â€¢ Edit approval status
                            â€¢ Adjust recommended amount
                            â€¢ Add approval notes
                            â€¢ Save changes
                            â”‚
                            â–¼
                      Updated in Database
                            â”‚
                            â–¼
                      Reflected in API
```

---

**End of Visual Flow Documentation**
