"use strict";(self.webpackChunkmaterial_dashboard_2_react=self.webpackChunkmaterial_dashboard_2_react||[]).push([[701],{1701:(e,t,n)=>{n.r(t),n.d(t,{default:()=>Ae});var i=n(9379),a=n(5043),l=n(6460),s=n(8294),r=n(2110),o=n(1797),c=n(8961),d=(n(7125),n(6801)),u=n(8944),h=n(1751),p=n(8095),m=n(7746),x=n(983);const A=e=>{if(null===e||void 0===e)return null;const t=Number(e);return Number.isNaN(t)?null:t},v=e=>{if(null===e||void 0===e)return null;const t=parseInt(e,10);return Number.isNaN(t)?null:t},j=e=>(null===e||void 0===e?void 0:e.submitted_at)||(null===e||void 0===e?void 0:e.created_at)||(null===e||void 0===e?void 0:e.updated_at)||null,g=e=>{var t,n,i,a;const l=null!==(t=null===e||void 0===e||null===(n=e.ai_analysis_data)||void 0===n||null===(i=n.loan_assessment)||void 0===i?void 0:i.interest_rate)&&void 0!==t?t:null===e||void 0===e||null===(a=e.ai_analysis_data)||void 0===a?void 0:a.interest_rate;if(null!==l&&void 0!==l){const e=Number(l);if(!Number.isNaN(e))return e}if(null!==(null===e||void 0===e?void 0:e.interest_rate)&&void 0!==(null===e||void 0===e?void 0:e.interest_rate)){const t=Number(e.interest_rate);if(!Number.isNaN(t))return t}return null},f=e=>{var t,n;if(null!==e&&void 0!==e&&e.full_name)return e.full_name;const i=(null===e||void 0===e?void 0:e.first_name)||(null===e||void 0===e||null===(t=e.personal_info)||void 0===t?void 0:t.first_name)||"",a=(null===e||void 0===e?void 0:e.last_name)||(null===e||void 0===e||null===(n=e.personal_info)||void 0===n?void 0:n.last_name)||"";return"".concat(i," ").concat(a).trim()||"Applicant"},y=e=>{var t,n,i,a;const l=((null===e||void 0===e?void 0:e.status)||"draft").toLowerCase();return{id:null===e||void 0===e?void 0:e.id,applicationId:null===e||void 0===e?void 0:e.application_id,borrowerName:f(e),email:(null===e||void 0===e?void 0:e.email)||(null===e||void 0===e||null===(t=e.personal_info)||void 0===t?void 0:t.email)||"",phone:(null===e||void 0===e?void 0:e.phone)||(null===e||void 0===e||null===(n=e.personal_info)||void 0===n?void 0:n.phone)||"",amount:null!==(i=A(null===e||void 0===e?void 0:e.amount))&&void 0!==i?i:0,interestRate:g(e),term:null!==(a=v(null===e||void 0===e?void 0:e.term))&&void 0!==a?a:null,status:l,applicationDate:j(e),createdAt:(null===e||void 0===e?void 0:e.created_at)||null,raw:e}};async function b(){const e=await(0,m.yN)();let t=[];return Array.isArray(e)?t=e:Array.isArray(null===e||void 0===e?void 0:e.results)?t=e.results:Array.isArray(null===e||void 0===e?void 0:e.applications)?t=e.applications:Array.isArray(null===e||void 0===e?void 0:e.data)&&(t=e.data),t.map(y)}async function w(e){let{approvedAmount:t,approvalNotes:n}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const i={approved_amount:Number(null!==t&&void 0!==t?t:0),approval_notes:null!==n&&void 0!==n?n:""};try{return await x.u.post("/loans/applications/".concat(e,"/approve/"),i)}catch(r){var a;if(400===(null===(a=r.response)||void 0===a?void 0:a.status)){var l,s;const e=(null===(l=r.response)||void 0===l||null===(s=l.data)||void 0===s?void 0:s.error)||"Cannot approve this application";throw new Error(e)}throw r}}async function C(e){let{reason:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await x.u.post("/loans/applications/".concat(e,"/reject/"),{notes:null!==t&&void 0!==t?t:""})}catch(l){var n;if(400===(null===(n=l.response)||void 0===n?void 0:n.status)){var i,a;const e=(null===(i=l.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.error)||"Cannot reject this application";throw new Error(e)}throw l}}async function _(e){let{message:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{return await x.u.post("/loans/applications/".concat(e,"/raise_query/"),{notes:null!==t&&void 0!==t?t:""})}catch(l){var n;if(400===(null===(n=l.response)||void 0===n?void 0:n.status)){var i,a;const e=(null===(i=l.response)||void 0===i||null===(a=i.data)||void 0===a?void 0:a.error)||"Cannot raise query for this application";throw new Error(e)}throw l}}const S=e=>e?e.toString().replace(/_/g," ").replace(/\b\w/g,e=>e.toUpperCase()):"--",N=e=>{const t=null===e||void 0===e?void 0:e.toLowerCase();return{canApprove:["pending","under_review"].includes(t),canReject:["pending","under_review"].includes(t),canQuery:"pending"===t,canWithdraw:["pending","under_review"].includes(t),statusMessage:k(t)}},k=e=>{switch(e){case"draft":return"Draft applications cannot be processed";case"approved":return"Application already approved";case"rejected":return"Application already rejected";case"withdrawn":return"Application already withdrawn";case"pending":return"All actions available";case"under_review":return"Can approve or reject";default:return"Unknown status"}};n(3581);var W=n(35),I=n(6600),R=n(5316),L=n(9347),D=n(8903),M=n(3845),z=n(7392),E=n(4208),B=n(120),P=n(5397),H=n(7254),F=n(9135),$=n(4794),O=n(7601),T=n(378),q=n(2143),Q=n(8587),V=n(8168),U=n(3024),X=n(8610),J=n(2876),Y=n(4535),Z=n(2532),G=n(2372);function K(e){return(0,G.Ay)("MuiCardMedia",e)}(0,Z.A)("MuiCardMedia",["root","media","img"]);var ee=n(579);const te=["children","className","component","image","src","style"],ne=(0,Y.Ay)("div",{name:"MuiCardMedia",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e,{isMediaComponent:i,isImageComponent:a}=n;return[t.root,i&&t.media,a&&t.img]}})(e=>{let{ownerState:t}=e;return(0,V.A)({display:"block",backgroundSize:"cover",backgroundRepeat:"no-repeat",backgroundPosition:"center"},t.isMediaComponent&&{width:"100%"},t.isImageComponent&&{objectFit:"cover"})}),ie=["video","audio","picture","iframe","img"],ae=["picture","img"],le=a.forwardRef(function(e,t){const n=(0,J.A)({props:e,name:"MuiCardMedia"}),{children:i,className:a,component:l="div",image:s,src:r,style:o}=n,c=(0,Q.A)(n,te),d=-1!==ie.indexOf(l),u=!d&&s?(0,V.A)({backgroundImage:'url("'.concat(s,'")')},o):o,h=(0,V.A)({},n,{component:l,isMediaComponent:d,isImageComponent:-1!==ae.indexOf(l)}),p=(e=>{const{classes:t,isMediaComponent:n,isImageComponent:i}=e,a={root:["root",n&&"media",i&&"img"]};return(0,X.A)(a,K,t)})(h);return(0,ee.jsx)(ne,(0,V.A)({className:(0,U.A)(p.root,a),as:l,role:!d&&s?"img":void 0,ref:t,style:u,ownerState:h,src:d?s||r:void 0},c,{children:i}))});var se=n(4669),re=n(4056),oe=n(6946),ce=n(9336);const de=e=>{let{open:t,onClose:n,imageSrc:i,title:a}=e;return(0,ee.jsxs)(W.A,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,children:[(0,ee.jsx)(I.A,{children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,ee.jsx)(c.A,{variant:"h6",children:a}),(0,ee.jsx)(z.A,{onClick:n,size:"small",children:(0,ee.jsx)(E.A,{children:"close"})})]})}),(0,ee.jsx)(R.A,{children:(0,ee.jsx)(o.A,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:(0,ee.jsx)("img",{src:i,alt:a,style:{maxWidth:"100%",maxHeight:"80vh",objectFit:"contain"}})})})]})},ue=e=>{let{children:t,value:n,index:i}=e;return(0,ee.jsx)("div",{role:"tabpanel",hidden:n!==i,children:n===i&&(0,ee.jsx)(o.A,{py:3,children:t})})},he=e=>{let{open:t,onClose:n,loan:i,onApprove:l,onDecline:s,onQuery:h}=e;const[p,m]=(0,a.useState)(0),[x,A]=(0,a.useState)(""),[v,j]=(0,a.useState)(""),[g,f]=(0,a.useState)(""),[y,b]=(0,a.useState)(""),[w,C]=(0,a.useState)(!1),[_,S]=(0,a.useState)({src:"",title:""});if(!i)return null;const N=[];return[{field:"photo_vin_sticker",title:"VIN Sticker"},{field:"photo_odometer",title:"Odometer"},{field:"photo_borrower",title:"Borrower ID"},{field:"photo_front_car",title:"Vehicle Front"},{field:"photo_vin",title:"VIN Plate"},{field:"photo_license",title:"Driver's License"},{field:"photo_insurance",title:"Insurance"}].forEach(e=>{let{field:t,title:n}=e;const a=i[t];a&&N.push({id:"".concat(i.id,"_").concat(t),title:n,src:a,field:t,type:"photo_field"})}),i.documents&&Array.isArray(i.documents)&&i.documents.forEach(e=>{N.push({id:e.id,title:e.title||e.document_type,src:e.file||e.url,field:e.document_type,type:"document",description:e.description,uploaded_at:e.uploaded_at,is_analyzed:e.is_analyzed})}),(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(W.A,{open:t,onClose:n,maxWidth:"lg",fullWidth:!0,children:[(0,ee.jsx)(I.A,{children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,ee.jsxs)(o.A,{children:[(0,ee.jsx)(c.A,{variant:"h5",children:"Loan Application Review"}),(0,ee.jsxs)(c.A,{variant:"caption",color:"text",children:["Application ID: ",i.applicationId||i.application_id||i.id]})]}),(0,ee.jsx)(M.A,{label:i.status,color:(k=i.status,{approved:"success",rejected:"error",pending:"warning",under_review:"info",draft:"secondary"}[k]||"primary"),size:"small",sx:{textTransform:"capitalize"}})]})}),(0,ee.jsxs)(R.A,{children:[(0,ee.jsx)(oe.A,{sx:{borderBottom:1,borderColor:"divider"},children:(0,ee.jsxs)(se.A,{value:p,onChange:(e,t)=>{m(t)},children:[(0,ee.jsx)(re.A,{label:"Application Details"}),(0,ee.jsx)(re.A,{label:"Submitted Photos"}),(0,ee.jsx)(re.A,{label:"AI Analysis"}),(0,ee.jsx)(re.A,{label:"Actions"})]})}),(0,ee.jsx)(ue,{value:p,index:0,children:(0,ee.jsxs)(D.Ay,{container:!0,spacing:3,children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(r.A,{sx:{p:2,height:"100%"},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Personal Information"}),(0,ee.jsxs)(o.A,{display:"flex",flexDirection:"column",gap:1,children:[(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Name:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.borrowerName||i.full_name||"".concat(i.first_name||""," ").concat(i.last_name||"").trim()||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Email:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.email||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Phone:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.phone||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"DOB:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.dob||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"SSN:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.social_security?"***-**-"+i.social_security.slice(-4):"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"ID Type:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.identification_type||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"ID Number:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.identification_no||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Bank Name:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.banks_name||"N/A"})]})]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(r.A,{sx:{p:2,height:"100%"},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Loan Details"}),(0,ee.jsxs)(o.A,{display:"flex",flexDirection:"column",gap:1,children:[(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Amount Requested:"}),(0,ee.jsxs)(c.A,{variant:"button",color:"success",children:["$",Number(i.amount||0).toLocaleString()]})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Term:"}),(0,ee.jsxs)(c.A,{variant:"button",children:[i.term," months"]})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Interest Rate:"}),(0,ee.jsxs)(c.A,{variant:"button",children:[i.interestRate||0,"%"]})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Application Date:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.applicationDate||i.created_at})]})]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(r.A,{sx:{p:2,height:"100%"},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Vehicle Information"}),(0,ee.jsxs)(o.A,{display:"flex",flexDirection:"column",gap:1,children:[(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Make/Model:"}),(0,ee.jsxs)(c.A,{variant:"button",children:[i.vehicle_make||i.vehicleMake," ",i.vehicle_model||i.vehicleModel]})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Year:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.vehicle_year||i.vehicleYear})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"VIN:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.vehicle_vin||i.vehicleVin})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Mileage:"}),(0,ee.jsxs)(c.A,{variant:"button",children:[Number(i.vehicle_mileage||i.vehicleMileage||0).toLocaleString()," mi"]})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Estimated Value:"}),(0,ee.jsxs)(c.A,{variant:"button",color:"info",children:["$",Number(i.applicant_estimated_value||0).toLocaleString()]})]})]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(r.A,{sx:{p:2,height:"100%"},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Financial Information"}),(0,ee.jsxs)(o.A,{display:"flex",flexDirection:"column",gap:1,children:[(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Employment Status:"}),(0,ee.jsx)(c.A,{variant:"button",sx:{textTransform:"capitalize"},children:i.employment_status||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Income Source:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.income_source||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Annual Income:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.income?"$".concat(Number(i.income).toLocaleString()):"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Monthly Income:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.gross_monthly_income?"$".concat(Number(i.gross_monthly_income).toLocaleString()):"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Employment Length:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.employment_length?"".concat(i.employment_length," years"):"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Pay Frequency:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.pay_frequency||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Credit Score:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.credit_score||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Active Bankruptcy:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.active_bankruptcy||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Direct Deposit:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.direct_deposit||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Military Status:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.military_status||"N/A"})]})]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(r.A,{sx:{p:2,height:"100%"},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Address Information"}),(0,ee.jsxs)(o.A,{display:"flex",flexDirection:"column",gap:1,children:[(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Street:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.street||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"City:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.city||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"State:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.state||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"ZIP Code:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.zip_code||"N/A"})]})]})]})}),(i.co_applicant_first_name||i.co_applicant_name)&&(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(r.A,{sx:{p:2,height:"100%"},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Co-Applicant Information"}),(0,ee.jsxs)(o.A,{display:"flex",flexDirection:"column",gap:1,children:[(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Name:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.co_applicant_name||"".concat(i.co_applicant_first_name||""," ").concat(i.co_applicant_last_name||"").trim()||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Email:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.co_applicant_email||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Phone:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.co_applicant_phone||"N/A"})]}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"SSN:"}),(0,ee.jsx)(c.A,{variant:"button",children:i.co_applicant_ssn?"***-**-"+i.co_applicant_ssn.slice(-4):"N/A"})]})]})]})}),i.additional_data&&Object.keys(i.additional_data).length>0&&(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsxs)(r.A,{sx:{p:2},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Additional Information"}),(0,ee.jsx)(D.Ay,{container:!0,spacing:2,children:Object.entries(i.additional_data).map(e=>{let[t,n]=e;const i=t.replace(/_/g," ").replace(/([A-Z])/g," $1").trim(),a=i.charAt(0).toUpperCase()+i.slice(1);return(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",children:[(0,ee.jsxs)(c.A,{variant:"button",fontWeight:"medium",children:[a,":"]}),(0,ee.jsx)(c.A,{variant:"button",children:"object"===typeof n?JSON.stringify(n):String(n)||"N/A"})]})},t)})})]})})]})}),(0,ee.jsx)(ue,{value:p,index:1,children:N.length>0?(0,ee.jsx)(D.Ay,{container:!0,spacing:2,children:N.map((e,t)=>(0,ee.jsx)(D.Ay,{item:!0,xs:12,sm:6,md:4,children:(0,ee.jsxs)(r.A,{sx:{cursor:"pointer",transition:"transform 0.2s","&:hover":{transform:"scale(1.02)",boxShadow:3}},onClick:()=>{return t=e.src,n=e.title,S({src:t,title:n}),void C(!0);var t,n},children:[(0,ee.jsx)(le,{component:"img",height:"200",image:e.src,alt:e.title,sx:{objectFit:"cover"}}),(0,ee.jsxs)(o.A,{p:2,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:e.title}),"document"===e.type&&(0,ee.jsxs)(ee.Fragment,{children:[e.description&&(0,ee.jsx)(c.A,{variant:"caption",color:"text",display:"block",children:e.description}),e.uploaded_at&&(0,ee.jsxs)(c.A,{variant:"caption",color:"text",display:"block",children:["Uploaded: ",new Date(e.uploaded_at).toLocaleDateString()]}),e.is_analyzed&&(0,ee.jsx)(M.A,{label:"AI Analyzed",size:"small",color:"success",sx:{mt:.5}})]})]})]})},t))}):(0,ee.jsxs)(o.A,{textAlign:"center",py:5,children:[(0,ee.jsx)(E.A,{fontSize:"large",color:"disabled",children:"image_not_supported"}),(0,ee.jsx)(c.A,{variant:"h6",color:"text",mt:2,children:"No photos submitted"})]})}),(0,ee.jsx)(ue,{value:p,index:2,children:(0,ee.jsxs)(D.Ay,{container:!0,spacing:3,children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsxs)(r.A,{sx:{p:3},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"AI Vehicle Valuation & Risk Assessment"}),i.ai_estimated_value||i.ai_analysis_data?(0,ee.jsxs)(D.Ay,{container:!0,spacing:2,children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:4,children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"AI Estimated Value:"}),(0,ee.jsxs)(c.A,{variant:"button",color:"success",children:["$",Number(i.ai_estimated_value||0).toLocaleString()]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:4,children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Applicant Estimate:"}),(0,ee.jsxs)(c.A,{variant:"button",children:["$",Number(i.applicant_estimated_value||0).toLocaleString()]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:4,children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",mb:1,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",children:"Loan Amount:"}),(0,ee.jsxs)(c.A,{variant:"button",children:["$",Number(i.amount||0).toLocaleString()]})]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(ce.A,{})}),(0,ee.jsxs)(D.Ay,{item:!0,xs:12,md:6,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",mb:1,display:"block",children:"Risk Assessment:"}),(0,ee.jsx)(M.A,{label:i.ai_risk_assessment||"N/A",color:"low"===i.ai_risk_assessment?"success":"high"===i.ai_risk_assessment||"very_high"===i.ai_risk_assessment?"error":"warning",size:"small",sx:{textTransform:"capitalize"}})]}),(0,ee.jsxs)(D.Ay,{item:!0,xs:12,md:6,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",mb:1,display:"block",children:"AI Approval Suggestion:"}),(0,ee.jsx)(M.A,{label:i.ai_approval_suggestion||"N/A",color:"approve"===i.ai_approval_suggestion?"success":"reject"===i.ai_approval_suggestion?"error":"warning",size:"small",sx:{textTransform:"capitalize"}})]}),(0,ee.jsxs)(D.Ay,{item:!0,xs:12,children:[(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",mb:1,display:"block",children:"AI Recommendation:"}),(0,ee.jsx)(c.A,{variant:"body2",color:"text",children:i.ai_recommendation||"No recommendation available"})]}),i.ai_analysis_timestamp&&(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsxs)(c.A,{variant:"caption",color:"text",children:["Analysis performed: ",new Date(i.ai_analysis_timestamp).toLocaleString()]})})]}):(0,ee.jsxs)(o.A,{textAlign:"center",py:3,children:[(0,ee.jsx)(E.A,{fontSize:"large",color:"disabled",children:"psychology_alt"}),(0,ee.jsx)(c.A,{variant:"body2",color:"text",mt:2,children:"AI analysis not yet available"})]})]})}),i.ai_analysis_data&&(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsxs)(r.A,{sx:{p:3},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:2,children:"Detailed Analysis Results"}),(0,ee.jsx)(o.A,{sx:{maxHeight:"300px",overflow:"auto",bgcolor:"#f5f5f5",p:2,borderRadius:1},children:(0,ee.jsx)("pre",{style:{fontSize:"12px",margin:0,whiteSpace:"pre-wrap",wordBreak:"break-word"},children:JSON.stringify(i.ai_analysis_data,null,2)})})]})})]})}),(0,ee.jsx)(ue,{value:p,index:3,children:(0,ee.jsxs)(r.A,{sx:{p:3},children:[(0,ee.jsx)(c.A,{variant:"h6",mb:3,children:"Review Actions"}),(0,ee.jsxs)(D.Ay,{container:!0,spacing:3,children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(u.$3,{label:"Select Action",value:x,onChange:e=>A(e.target.value),options:[{value:"",label:"-- Choose an action --"},{value:"approve",label:"Approve Application"},{value:"decline",label:"Decline Application"},{value:"query",label:"Raise Query"}],fullWidth:!0})}),"approve"===x&&(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsx)(u.RL,{label:"Approved Amount ($)",type:"number",value:y,onChange:e=>b(e.target.value),placeholder:"Requested: $".concat(i.amount),fullWidth:!0})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(u.XC,{label:"Approval Notes (Optional)",value:g,onChange:e=>f(e.target.value),rows:4,placeholder:"Enter any notes for the borrower...",fullWidth:!0})})]}),"decline"===x&&(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(u.XC,{label:"Reason for Declining *",value:v,onChange:e=>j(e.target.value),rows:4,placeholder:"Please provide a clear reason for declining this application...",fullWidth:!0,required:!0})}),"query"===x&&(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(u.XC,{label:"Query Message *",value:g,onChange:e=>f(e.target.value),rows:4,placeholder:"E.g., 'The photos submitted are not clear. Please upload clearer images of the VIN and odometer.'",fullWidth:!0,required:!0})})]})]})})]}),(0,ee.jsxs)(L.A,{children:[(0,ee.jsx)(d.A,{onClick:n,variant:"outlined",color:"secondary",children:"Cancel"}),x&&(0,ee.jsx)(d.A,{onClick:async()=>{if("approve"===x)await l(i.id,{approvedAmount:y||i.amount,approvalNotes:g});else if("decline"===x){if(!v.trim())return void alert("Please provide a reason for declining");await s(i.id,{reason:v})}else if("query"===x){if(!g.trim())return void alert("Please provide a query message");await h(i.id,{notes:g})}A(""),j(""),f(""),b(""),n()},variant:"gradient",color:"approve"===x?"success":"decline"===x?"error":"warning",children:"approve"===x?"Approve Application":"decline"===x?"Decline Application":"Send Query"})]})]}),(0,ee.jsx)(de,{open:w,onClose:()=>C(!1),imageSrc:_.src,title:_.title})]});var k},pe=e=>({id:e.id,applicationId:e.applicationId,borrowerName:e.borrowerName,email:e.email,phone:e.phone,amount:e.amount,interestRate:e.interestRate,term:e.term,status:S(e.status),applicationDate:e.applicationDate});function me(e){let{open:t,onClose:n,loan:l,onSave:s}=e;const[r,o]=(0,a.useState)({amount:0,interestRate:0,term:0,status:"",remainingBalance:0,monthlyPayment:0});return(0,a.useEffect)(()=>{l&&o({amount:l.amount||0,interestRate:l.interestRate||0,term:l.term||0,status:l.status||"",remainingBalance:l.remainingBalance||0,monthlyPayment:l.monthlyPayment||0})},[l]),l?(0,ee.jsxs)(W.A,{open:t,onClose:n,fullWidth:!0,maxWidth:"md",children:[(0,ee.jsxs)(I.A,{children:["Edit Loan: ",l.id]}),(0,ee.jsx)(R.A,{children:(0,ee.jsxs)(D.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsx)(u.RL,{label:"Loan Amount ($)",fullWidth:!0,type:"number",value:r.amount,onChange:e=>o(t=>(0,i.A)((0,i.A)({},t),{},{amount:parseFloat(e.target.value)||0}))})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsx)(u.RL,{label:"Interest Rate (%)",fullWidth:!0,type:"number",step:"0.01",value:r.interestRate,onChange:e=>o(t=>(0,i.A)((0,i.A)({},t),{},{interestRate:parseFloat(e.target.value)||0}))})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:4,children:(0,ee.jsx)(u.RL,{label:"Term (months)",fullWidth:!0,type:"number",value:r.term,onChange:e=>o(t=>(0,i.A)((0,i.A)({},t),{},{term:parseInt(e.target.value)||0}))})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:4,children:(0,ee.jsx)(u.$3,{label:"Status",fullWidth:!0,value:r.status,onChange:e=>o(t=>(0,i.A)((0,i.A)({},t),{},{status:e.target.value})),options:["draft","pending","under_review","approved","rejected","withdrawn"].map(e=>({value:e,label:S(e)}))})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:4,children:(0,ee.jsx)(u.RL,{label:"Monthly Extension ($)",fullWidth:!0,type:"number",value:r.monthlyPayment,onChange:e=>o(t=>(0,i.A)((0,i.A)({},t),{},{monthlyPayment:parseFloat(e.target.value)||0}))})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,children:(0,ee.jsx)(u.RL,{label:"Remaining Balance ($)",fullWidth:!0,type:"number",value:r.remainingBalance,onChange:e=>o(t=>(0,i.A)((0,i.A)({},t),{},{remainingBalance:parseFloat(e.target.value)||0}))})})]})}),(0,ee.jsxs)(L.A,{children:[(0,ee.jsx)(d.A,{variant:"outlined",onClick:n,children:"Cancel"}),(0,ee.jsx)(d.A,{variant:"contained",onClick:()=>s((0,i.A)((0,i.A)({},l),r)),children:"Save Changes"})]})]}):null}function xe(e){let{open:t,onClose:n,selectedLoans:i,onBulkAction:l}=e;const[s,r]=(0,a.useState)("approve"),[o,c]=(0,a.useState)(""),h=()=>{c(""),r("approve"),n()};return(0,ee.jsxs)(W.A,{open:t,onClose:h,maxWidth:"sm",fullWidth:!0,children:[(0,ee.jsxs)(I.A,{children:["Bulk Loan Actions (",i.length," loans)"]}),(0,ee.jsx)(R.A,{children:(0,ee.jsxs)(D.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(u.$3,{label:"Action",fullWidth:!0,value:s,onChange:e=>r(e.target.value),options:[{value:"approve",label:"Approve"},{value:"reject",label:"Reject"},{value:"flag",label:"Flag for Review"}]})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,children:(0,ee.jsx)(u.XC,{label:"Notes",fullWidth:!0,minRows:3,value:o,onChange:e=>c(e.target.value),placeholder:"Optional message shared with applicants"})})]})}),(0,ee.jsxs)(L.A,{children:[(0,ee.jsx)(d.A,{variant:"outlined",onClick:h,children:"Cancel"}),(0,ee.jsx)(d.A,{variant:"contained",onClick:()=>{const e=i.map(e=>e.id);switch(s){case"approve":l("approve",e,{notes:o});break;case"reject":l("deny",e,{reason:o});break;case"flag":l("flag",e,{notes:o})}c(""),r("approve"),n()},disabled:0===i.length,children:"Apply"})]})]})}const Ae=function(){const[e,t]=(0,a.useState)([]),[n,m]=(0,a.useState)([]),[x,A]=(0,a.useState)(0),[v,j]=(0,a.useState)(!1),[g,f]=(0,a.useState)(""),[y,k]=(0,a.useState)(""),[W,I]=(0,a.useState)(""),[R,L]=(0,a.useState)(""),[Q,V]=(0,a.useState)(""),[U,X]=(0,a.useState)(""),[J,Y]=(0,a.useState)(1),[Z,G]=(0,a.useState)(10),[K,te]=(0,a.useState)("applicationDate"),[ne,ie]=(0,a.useState)("desc"),[ae,le]=(0,a.useState)([]),[se,re]=(0,a.useState)(!1),[oe,ce]=(0,a.useState)(null),[de,ue]=(0,a.useState)(!1),[Ae,ve]=(0,a.useState)(!1),[je,ge]=(0,a.useState)(null),[fe,ye]=(0,a.useState)(!1),[be,we]=(0,a.useState)(null),[Ce,_e]=(0,a.useState)(null),[Se,Ne]=(0,a.useState)({open:!1,message:"",severity:"success"}),ke=(0,a.useCallback)(function(e){Ne({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},[]),We=(0,a.useCallback)(async()=>{j(!0);try{const e=await b();t(e),le([]),re(!1)}catch(e){console.error("Error loading loans",e),ke("Error loading loans","error")}finally{j(!1)}},[ke]);(0,a.useEffect)(()=>{We()},[We]);const Ie=(0,a.useMemo)(()=>{let t=[...e];if(g){const e=g.toLowerCase();t=t.filter(t=>[t.id,t.applicationId,t.borrowerName,t.email,t.phone,t.status].some(t=>t&&t.toString().toLowerCase().includes(e)))}y&&(t=t.filter(e=>e.status===y));const n=e=>{if(!e)return null;const t=new Date(e);return Number.isNaN(t.getTime())?null:t},i=n(W),a=n(R);i&&(t=t.filter(e=>{const t=n(e.applicationDate);return!!t&&t>=i})),a&&(t=t.filter(e=>{const t=n(e.applicationDate);return!!t&&t<=a}));const l=Q?Number(Q):null,s=U?Number(U):null;null===l||Number.isNaN(l)||(t=t.filter(e=>(e.amount||0)>=l)),null===s||Number.isNaN(s)||(t=t.filter(e=>(e.amount||0)<=s));const r=e=>{var t,i,a,l;switch(K){case"applicationDate":return(null===(t=n(e.applicationDate))||void 0===t?void 0:t.getTime())||0;case"amount":return null!==(i=e.amount)&&void 0!==i?i:0;case"interestRate":return null!==(a=e.interestRate)&&void 0!==a?a:0;case"term":return null!==(l=e.term)&&void 0!==l?l:0;case"status":return e.status||"";default:return e[K]}};return t.sort((e,t)=>{const n=r(e),i=r(t);if("string"===typeof n||"string"===typeof i){const e=String(n||"").localeCompare(String(i||""));return"asc"===ne?e:-e}const a=(Number(n)||0)-(Number(i)||0);return"asc"===ne?a:-a}),t},[e,g,y,W,R,Q,U,K,ne]);(0,a.useEffect)(()=>{const e=Ie.length,t=Math.max(1,Math.ceil(e/Z));if(J>t)return void Y(t);const n=(J-1)*Z,i=Ie.slice(n,n+Z);m(i),A(e)},[Ie,J,Z]);const Re=(0,a.useCallback)(t=>e.find(e=>String(e.id)===String(t)),[e]),Le=(0,a.useCallback)(function(e){ke(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"),We()},[We,ke]),De=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const n=Re(e),i=N(null===n||void 0===n?void 0:n.status);if(!i.canApprove)return void ke(i.statusMessage,"warning");await w(e,{approvedAmount:null===n||void 0===n?void 0:n.amount,approvalNotes:t}),Le("Loan approved successfully")}catch(n){console.error("Error approving loan",n);const e=n.message||"Error approving loan";ke(e,"error")}},Me=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const n=Re(e),i=N(null===n||void 0===n?void 0:n.status);if(!i.canReject)return void ke(i.statusMessage,"warning");await C(e,{reason:t}),Le("Loan rejected")}catch(n){console.error("Error rejecting loan",n);const e=n.message||"Error rejecting loan";ke(e,"error")}},ze=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";try{const n=Re(e),i=N(null===n||void 0===n?void 0:n.status);if(!i.canQuery)return void ke(i.statusMessage,"warning");await _(e,{message:t}),Le("Loan flagged for review")}catch(n){console.error("Error flagging loan",n);const e=n.message||"Error flagging loan";ke(e,"error")}},Ee=Math.max(1,Math.ceil(x/Z)),Be=e=>{switch(e){case"approved":return"success";case"rejected":case"denied":return"error";case"pending":return"warning";case"under_review":return"info";case"withdrawn":return"secondary";case"draft":return"default";default:return"primary"}},Pe=(0,a.useMemo)(()=>{const e=Ie;return{totalLoans:e.length,approvedCount:e.filter(e=>"approved"===e.status).length,pendingCount:e.filter(e=>"pending"===e.status).length,underReviewCount:e.filter(e=>"under_review"===e.status).length,rejectedCount:e.filter(e=>"rejected"===e.status||"denied"===e.status).length,totalAmount:e.reduce((e,t)=>e+(Number(t.amount)||0),0)}},[Ie]);return(0,ee.jsxs)(l.A,{children:[(0,ee.jsx)(s.A,{}),(0,ee.jsx)(o.A,{mb:3,children:(0,ee.jsxs)(D.Ay,{container:!0,spacing:3,children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,lg:3,children:(0,ee.jsx)("div",{className:"loan-management-card enhanced-stats-card",children:(0,ee.jsx)(O.A,{color:"success",icon:(0,ee.jsx)(E.A,{className:"glow-icon-loan glow-icon-active",sx:{fontSize:28},children:"account_balance"}),title:"Loan Applications",count:Pe.totalLoans.toString(),percentage:{color:"success",amount:"".concat(Pe.approvedCount," approved"),label:"current view"}})})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,lg:3,children:(0,ee.jsx)("div",{className:"loan-management-card enhanced-stats-card",children:(0,ee.jsx)(O.A,{color:"success",icon:(0,ee.jsx)(E.A,{className:"glow-icon-loan glow-icon-success",sx:{fontSize:28},children:"trending_up"}),title:"Approved Loans",count:Pe.approvedCount.toString(),percentage:{color:"success",amount:"".concat(Pe.rejectedCount," rejected"),label:"decisioned"}})})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,lg:3,children:(0,ee.jsx)("div",{className:"loan-management-card enhanced-stats-card",children:(0,ee.jsx)(O.A,{color:"warning",icon:(0,ee.jsx)(E.A,{className:"glow-icon-loan glow-icon-pending",sx:{fontSize:28},children:"hourglass_empty"}),title:"Pending Decisions",count:(Pe.pendingCount+Pe.underReviewCount).toString(),percentage:{color:"warning",amount:"".concat(Pe.pendingCount," pending"),label:"".concat(Pe.underReviewCount," flagged")}})})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:6,lg:3,children:(0,ee.jsx)("div",{className:"loan-management-card enhanced-stats-card",children:(0,ee.jsx)(O.A,{color:"info",icon:(0,ee.jsx)(E.A,{className:"glow-icon-loan glow-icon-success",sx:{fontSize:28},children:"help_outline"}),title:"Flagged Queries",count:Pe.underReviewCount.toString(),percentage:{color:"info",amount:"$".concat(Pe.totalAmount.toLocaleString(void 0,{minimumFractionDigits:0,maximumFractionDigits:0})),label:"total requested"}})})})]})}),(0,ee.jsx)(r.A,{children:(0,ee.jsx)(o.A,{p:3,children:(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,ee.jsxs)(o.A,{children:[(0,ee.jsx)(c.A,{variant:"h5",fontWeight:"bold",color:"success",children:"Loans Management"}),(0,ee.jsxs)(c.A,{variant:"caption",color:"text",children:["Total: ",x," loans | Selected: ",ae.length]})]}),(0,ee.jsxs)(o.A,{display:"flex",gap:1,children:[(0,ee.jsx)(d.A,{variant:"outlined",onClick:()=>{const e=ae.length?ae:Ie;((e,t)=>{if(!t.length)return;const n=t.map(pe),i=Object.keys(n[0]),a=[i.join(",")];n.forEach(e=>{const t=i.map(t=>{const n=e[t];if(null===n||void 0===n)return"";const i=String(n).replace(/"/g,'""');return'"'.concat(i,'"')});a.push(t.join(","))});const l=new Blob([a.join("\n")],{type:"text/csv;charset=utf-8;"}),s=document.createElement("a");s.href=URL.createObjectURL(l),s.setAttribute("download",e),document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(s.href)})("drivecash_loans.csv",e),ke("Exported ".concat(e.length," loans to CSV"))},disabled:!Ie.length,children:"Export CSV"}),(0,ee.jsx)(d.A,{variant:"outlined",onClick:()=>{const e=ae.length?ae:Ie;((e,t)=>{const n=t.map(pe),i=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),a=document.createElement("a");a.href=URL.createObjectURL(i),a.setAttribute("download",e),document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(a.href)})("drivecash_loans.json",e),ke("Exported ".concat(e.length," loans to JSON"))},children:"Export JSON"}),ae.length>0&&(0,ee.jsxs)(d.A,{variant:"contained",color:"warning",onClick:()=>ve(!0),children:["Bulk Actions (",ae.length,")"]})]})]})})}),(0,ee.jsxs)(r.A,{sx:{p:3,mb:3},children:[(0,ee.jsx)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:(0,ee.jsxs)(o.A,{display:"flex",alignItems:"center",gap:2,children:[(0,ee.jsx)(c.A,{variant:"h6",fontWeight:"medium",color:"success",children:"Filters & Search"}),(0,ee.jsx)(u.RL,{placeholder:"Search loans...",value:g,onChange:e=>{f(e.target.value),Y(1)},sx:{width:250},size:"small"})]})}),(0,ee.jsx)(D.Ay,{container:!0,spacing:2,justifyContent:"center",mb:2,children:(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:10,children:(0,ee.jsx)(o.A,{display:"flex",justifyContent:"center",children:(0,ee.jsxs)(D.Ay,{container:!0,spacing:2,sx:{maxWidth:920},justifyContent:"center",children:[(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:2.4,children:(0,ee.jsx)(u.$3,{label:"Status",fullWidth:!0,value:y,onChange:e=>{k(e.target.value),Y(1)},options:["","draft","pending","under_review","approved","rejected","withdrawn"].map(e=>({value:e,label:e?S(e):"All"})),sx:{"& .MuiInputBase-root":{height:40}}})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:2.2,children:(0,ee.jsx)(u.RL,{label:"Date From",type:"date",fullWidth:!0,value:W,onChange:e=>{I(e.target.value),Y(1)},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-root":{height:40}}})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:2.2,children:(0,ee.jsx)(u.RL,{label:"Date To",type:"date",fullWidth:!0,value:R,onChange:e=>{L(e.target.value),Y(1)},InputLabelProps:{shrink:!0},sx:{"& .MuiInputBase-root":{height:40}}})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:2.1,children:(0,ee.jsx)(u.RL,{label:"Min Amount",type:"number",fullWidth:!0,value:Q,onChange:e=>{V(e.target.value),Y(1)},sx:{"& .MuiInputBase-root":{height:40}}})}),(0,ee.jsx)(D.Ay,{item:!0,xs:12,md:2.1,children:(0,ee.jsx)(u.RL,{label:"Max Amount",type:"number",fullWidth:!0,value:U,onChange:e=>{X(e.target.value),Y(1)},sx:{"& .MuiInputBase-root":{height:40}}})})]})})})}),(0,ee.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,ee.jsx)(d.A,{variant:"outlined",onClick:()=>{f(""),k(""),I(""),L(""),V(""),X(""),Y(1)},size:"small",children:"Clear Filters"}),(0,ee.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,ee.jsx)(c.A,{variant:"caption",children:"Sort by:"}),(0,ee.jsx)(u.$3,{size:"small",value:K,onChange:e=>te(e.target.value),options:[{value:"applicationDate",label:"Application Date"},{value:"amount",label:"Amount"},{value:"interestRate",label:"Interest Rate"},{value:"term",label:"Term"},{value:"status",label:"Status"}]}),(0,ee.jsx)(u.$3,{size:"small",value:ne,onChange:e=>ie(e.target.value),options:[{value:"asc",label:"Ascending"},{value:"desc",label:"Descending"}]})]})]})]}),(0,ee.jsxs)(r.A,{children:[(0,ee.jsx)(h.A,{columns:[{id:"id",label:"Loan ID",width:120,minWidth:100,align:"left",format:e=>(0,ee.jsx)(o.A,{className:"loan-id",minHeight:"48px",display:"flex",alignItems:"center",children:(0,ee.jsx)(c.A,{variant:"button",fontWeight:"medium",noWrap:!0,children:e})})},{id:"borrowerName",label:"Borrower",width:200,minWidth:150,align:"left",format:e=>(0,ee.jsx)(o.A,{className:"loan-borrower",minHeight:"48px",display:"flex",alignItems:"center",children:(0,ee.jsx)(c.A,{variant:"body2",noWrap:!0,title:e,children:e})})},{id:"amount",label:"Amount",width:140,align:"right",format:e=>(0,ee.jsx)(o.A,{className:"loan-amount",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"flex-end",children:(0,ee.jsx)(c.A,{variant:"body2",fontWeight:"medium",color:"success",children:p._J.currency(e)})})},{id:"interestRate",label:"Rate",width:100,align:"center",format:e=>(0,ee.jsx)(o.A,{className:"loan-rate",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"center",children:(0,ee.jsx)(c.A,{variant:"body2",fontWeight:"medium",children:p._J.percentage(e)})})},{id:"term",label:"Term",width:120,align:"center",format:e=>(0,ee.jsx)(o.A,{className:"loan-term",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"center",children:(0,ee.jsxs)(c.A,{variant:"body2",children:[e," months"]})})},{id:"status",label:"Status",width:120,align:"center",format:e=>(0,ee.jsx)(o.A,{className:"loan-status status-chip",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"center",children:(0,ee.jsx)(M.A,{label:S(e),color:Be(e),size:"small"})})},{id:"applicationDate",label:"Applied",width:130,align:"center",format:e=>(0,ee.jsx)(o.A,{className:"loan-date",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"center",children:(0,ee.jsx)(c.A,{variant:"body2",children:p._J.date(e)})})},{id:"actions",label:"Actions",width:200,align:"center",format:(e,t)=>(0,ee.jsxs)(o.A,{className:"loan-actions",minHeight:"48px",display:"flex",alignItems:"center",justifyContent:"center",gap:1,children:[(0,ee.jsx)(B.A,{title:"Actions Menu",children:(0,ee.jsx)(z.A,{size:"small",onClick:e=>{we(e.currentTarget),_e(t)},sx:{width:36,height:36,bgcolor:(0,$.X4)("#1976d2",.08),"&:hover":{bgcolor:(0,$.X4)("#1976d2",.15)}},children:(0,ee.jsx)(E.A,{fontSize:"small",children:"more_vert"})})}),(0,ee.jsx)(B.A,{title:"Review Application",children:(0,ee.jsx)(z.A,{size:"small",onClick:()=>{ge(t),ye(!0)},sx:{width:36,height:36,bgcolor:(0,$.X4)("#2196f3",.08),"&:hover":{bgcolor:(0,$.X4)("#2196f3",.15)}},children:(0,ee.jsx)(E.A,{fontSize:"small",children:"visibility"})})}),("pending"===t.status||"under_review"===t.status)&&(0,ee.jsx)(B.A,{title:"Quick Approve",children:(0,ee.jsx)(z.A,{size:"small",onClick:()=>De(t.id),sx:{width:36,height:36,color:"#4caf50","&:hover":{bgcolor:(0,$.X4)("#4caf50",.1)}},children:(0,ee.jsx)(E.A,{fontSize:"small",children:"check_circle"})})}),("pending"===t.status||"under_review"===t.status)&&(0,ee.jsx)(B.A,{title:"Quick Decline",children:(0,ee.jsx)(z.A,{size:"small",onClick:()=>Me(t.id,"Quick decline"),sx:{width:36,height:36,color:"#f44336","&:hover":{bgcolor:(0,$.X4)("#f44336",.1)}},children:(0,ee.jsx)(E.A,{fontSize:"small",children:"cancel"})})})]})}],data:n,selectedItems:ae,onSelectAll:e=>{re(e),le(e?n.filter(e=>["pending","under_review"].includes(e.status)):[])},onSelectItem:(e,t)=>{t?le([...ae,e]):(le(ae.filter(t=>t.id!==e.id)),re(!1))},showCheckbox:!0,stickyHeader:!1,maxHeight:"70vh"}),(0,ee.jsxs)(T.A,{anchorEl:be,open:Boolean(be),onClose:()=>we(null),PaperProps:{sx:{minWidth:200}},children:[(0,ee.jsxs)(q.A,{onClick:()=>{ge(Ce),ye(!0),we(null)},children:[(0,ee.jsx)(E.A,{sx:{mr:1},children:"visibility"}),"Review Application"]}),(0,ee.jsxs)(q.A,{onClick:()=>{ce(Ce),ue(!0),we(null)},children:[(0,ee.jsx)(E.A,{sx:{mr:1},children:"edit"}),"Edit Details"]}),Ce&&("pending"===Ce.status||"under_review"===Ce.status)&&(0,ee.jsxs)(ee.Fragment,{children:[(0,ee.jsxs)(q.A,{onClick:()=>{De(Ce.id),we(null)},sx:{color:"#4caf50"},children:[(0,ee.jsx)(E.A,{sx:{mr:1},children:"check_circle"}),"Approve"]}),(0,ee.jsxs)(q.A,{onClick:()=>{Me(Ce.id),we(null)},sx:{color:"#f44336"},children:[(0,ee.jsx)(E.A,{sx:{mr:1},children:"cancel"}),"Decline"]}),(0,ee.jsxs)(q.A,{onClick:()=>{ze(Ce.id),we(null)},sx:{color:"#ff9800"},children:[(0,ee.jsx)(E.A,{sx:{mr:1},children:"help_outline"}),"Raise Query"]})]})]}),(0,ee.jsxs)(o.A,{p:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,ee.jsxs)(o.A,{display:"flex",alignItems:"center",gap:2,children:[(0,ee.jsx)(c.A,{variant:"caption",children:"Page size:"}),(0,ee.jsx)(u.$3,{size:"small",value:Z,onChange:e=>{G(Number(e.target.value)),Y(1)},options:[{value:5,label:"5"},{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"}]})]}),(0,ee.jsx)(F.A,{count:Ee,page:J,onChange:(e,t)=>Y(t),color:"primary"})]})]}),(0,ee.jsx)(me,{open:de,onClose:()=>ue(!1),loan:oe,onSave:()=>{ke("Editing loans is not supported yet","info"),ue(!1)}}),(0,ee.jsx)(xe,{open:Ae,onClose:()=>ve(!1),selectedLoans:ae,onBulkAction:async function(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t.length)return void ke("No loans selected","warning");const i=[],a=[];if(t.forEach(t=>{const n=Re(t),l=N(null===n||void 0===n?void 0:n.status);let s=!1;switch(e){case"approve":s=l.canApprove;break;case"deny":s=l.canReject;break;case"flag":s=l.canQuery}s?i.push(t):a.push({id:t,status:null===n||void 0===n?void 0:n.status,message:l.statusMessage})}),a.length>0){const e="".concat(a.length," loan(s) cannot be processed due to their status");ke(e,"warning")}if(0!==i.length)try{switch(e){case"approve":await Promise.all(i.map(e=>{var t,i,a;return w(e,{approvedAmount:null!==(t=null!==(i=n.approvedAmount)&&void 0!==i?i:null===(a=Re(e))||void 0===a?void 0:a.amount)&&void 0!==t?t:0,approvalNotes:n.notes})})),Le("".concat(i.length," loan(s) approved"));break;case"deny":await Promise.all(i.map(e=>C(e,{reason:n.reason}))),Le("".concat(i.length," loan(s) rejected"));break;case"flag":await Promise.all(i.map(e=>_(e,{message:n.notes}))),Le("".concat(i.length," loan(s) flagged for review"));break;default:ke("Bulk action not supported","warning")}}catch(l){console.error("Error performing bulk ".concat(e),l);const t=l.message||"Error performing bulk ".concat(e);ke(t,"error")}else ke("No eligible loans to process","warning")}}),(0,ee.jsx)(he,{open:fe,onClose:()=>{ye(!1),ge(null)},loan:je,onApprove:De,onDecline:Me,onQuery:ze}),(0,ee.jsx)(P.A,{open:Se.open,autoHideDuration:4e3,onClose:()=>Ne((0,i.A)((0,i.A)({},Se),{},{open:!1})),children:(0,ee.jsx)(H.A,{severity:Se.severity,onClose:()=>Ne((0,i.A)((0,i.A)({},Se),{},{open:!1})),children:Se.message})})]})}},1751:(e,t,n)=>{n.d(t,{A:()=>y});n(5043);var i=n(9650),a=n(4882),l=n(39),s=n(8076),r=n(3336),o=n(1806),c=n(1962),d=n(3460),u=n(4535),h=n(1797),p=n(8961),m=n(579);const x=(0,u.Ay)(i.A)(e=>{let{theme:t}=e;return{borderRadius:t.spacing(2),overflow:"hidden",boxShadow:"none",border:"1px solid ".concat(t.palette.grey[200])}}),A=(0,u.Ay)(a.A)(e=>{let{theme:t}=e;return{backgroundColor:t.palette.grey[50]}}),v=(0,u.Ay)(l.A)(e=>{let{theme:t,width:n}=e;return{padding:t.spacing(2),fontSize:"0.875rem",fontWeight:500,borderBottom:"1px solid ".concat(t.palette.grey[200]),whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",width:n||"auto",maxWidth:n?"".concat(n,"px"):"none",verticalAlign:"middle",height:"auto",minHeight:"56px","&.MuiTableCell-head":{backgroundColor:t.palette.grey[50],fontWeight:600,color:t.palette.text.primary,textTransform:"uppercase",fontSize:"0.75rem",letterSpacing:"0.5px",verticalAlign:"middle",height:"56px"},"&.MuiTableCell-body":{verticalAlign:"middle",height:"auto",minHeight:"56px"},"& > *":{display:"flex",alignItems:"center",minHeight:"40px"},"&.MuiTableCell-paddingCheckbox":{"& > *":{display:"flex",alignItems:"center",justifyContent:"center"}}}}),j=(0,u.Ay)(s.A)(e=>{let{theme:t}=e;return{"&:hover":{backgroundColor:t.palette.action.hover},"&:last-child td":{borderBottom:0}}}),g=(0,u.Ay)(h.A)({display:"flex",alignItems:"center",justifyContent:"inherit",maxWidth:"100%",overflow:"hidden",minHeight:"48px",width:"100%","& .MuiChip-root":{margin:"2px 0"},"& .MuiIconButton-root":{margin:"0",padding:"8px"},"& .MuiAvatar-root":{margin:"2px 0"},"& .MuiTypography-root":{lineHeight:"1.4",display:"flex",alignItems:"center"}}),f=(0,u.Ay)(p.A)(e=>{let{maxWidth:t=200}=e;return{maxWidth:"".concat(t,"px"),overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}});const y=function(e){let{columns:t=[],data:n=[],selectedItems:i=[],onSelectAll:a,onSelectItem:l,showCheckbox:u=!1,stickyHeader:y=!1,maxHeight:b="auto",responsive:w=!0}=e;const C=n.length>0&&i.length===n.length,_=i.length>0&&i.length<n.length;return(0,m.jsx)(x,{component:r.A,sx:{maxHeight:b,overflow:"auto"},children:(0,m.jsxs)(o.A,{stickyHeader:y,size:"medium",children:[(0,m.jsx)(A,{children:(0,m.jsxs)(s.A,{children:[u&&(0,m.jsx)(v,{padding:"checkbox",width:50,children:(0,m.jsx)(c.A,{indeterminate:_,checked:C,onChange:e=>{a&&a(e.target.checked)},color:"primary"})}),t.map(e=>(0,m.jsx)(v,{align:e.align||"left",width:e.width,sx:{minWidth:e.minWidth||"auto"},children:e.label},e.id))]})}),(0,m.jsxs)(d.A,{children:[n.map((e,n)=>{return(0,m.jsxs)(j,{children:[u&&(0,m.jsx)(v,{padding:"checkbox",children:(0,m.jsx)(c.A,{checked:i.some(t=>t.id===e.id),onChange:(a=e,e=>{l&&l(a,e.target.checked)}),color:"primary"})}),t.map(t=>(0,m.jsx)(v,{align:t.align||"left",width:t.width,children:(0,m.jsx)(g,{children:t.format?t.format(e[t.id],e):(0,m.jsx)(f,{variant:"body2",maxWidth:t.maxWidth||200,title:String(e[t.id]),children:e[t.id]})})},t.id))]},e.id||n);var a}),0===n.length&&(0,m.jsx)(j,{children:(0,m.jsx)(v,{colSpan:t.length+(u?1:0),align:"center",children:(0,m.jsx)(h.A,{py:4,children:(0,m.jsx)(p.A,{variant:"body2",color:"text",opacity:.7,children:"No data available"})})})})]})]})})}},3581:()=>{}}]);
//# sourceMappingURL=701.00e12f55.chunk.js.map