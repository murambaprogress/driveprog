"use strict";(self.webpackChunkmaterial_dashboard_2_react=self.webpackChunkmaterial_dashboard_2_react||[]).push([[207],{7207:(e,t,n)=>{n.r(t),n.d(t,{default:()=>I});var a=n(9379),l=n(5043),s=n(6460),i=n(8294),r=n(2110),o=n(1797),c=n(8961),d=n(6801),u=n(1758),m=n(1751),p=n(8903),h=n(5658),x=n(8095),y=n(579);(0,h.Ay)(r.A)(e=>{let{theme:t,elevation:n=1}=e;return{borderRadius:t.spacing(2),padding:t.spacing(3),boxShadow:"none"===n?"none":t.shadows[n],border:"1px solid ".concat(t.palette.grey[200]),height:"100%",display:"flex",flexDirection:"column",transition:"box-shadow 0.3s ease-in-out","&:hover":{boxShadow:"none"!==n?t.shadows[Math.min(n+2,24)]:"none"},[t.breakpoints.down("md")]:{padding:t.spacing(2)},[t.breakpoints.down("sm")]:{padding:t.spacing(1.5)}}}),(0,h.Ay)(p.Ay)(e=>{let{theme:t}=e;return{gap:t.spacing(3),[t.breakpoints.down("md")]:{gap:t.spacing(2)},[t.breakpoints.down("sm")]:{gap:t.spacing(1.5)}}}),(0,h.Ay)(o.A)(e=>{let{theme:t}=e;return{display:"flex",alignItems:"center",justifyContent:"space-between",padding:t.spacing(1.5,0),borderBottom:"1px solid ".concat(t.palette.grey[100]),"&:last-child":{borderBottom:"none"},[t.breakpoints.down("sm")]:{flexDirection:"column",alignItems:"flex-start",gap:t.spacing(.5)}}}),(0,h.Ay)(o.A)(e=>{let{theme:t}=e;return{display:"flex",gap:t.spacing(1.5),marginTop:"auto",paddingTop:t.spacing(2),borderTop:"1px solid ".concat(t.palette.grey[100]),[t.breakpoints.down("sm")]:{flexDirection:"column",gap:t.spacing(1)},"& .MuiButton-root, & .MDButton-root":{flex:1,minHeight:"40px",[t.breakpoints.down("sm")]:{width:"100%"}}}});var g=n(7311),A=n(35),b=n(6600),f=n(5316),j=n(9347),v=n(3845),C=n(7392),w=n(4208),S=n(5397),k=n(7254),P=n(9135);function D(e){let{open:t,onClose:n,payment:a,onRefund:l,onCancel:s}=e;return a?(0,y.jsxs)(A.A,{open:t,onClose:n,fullWidth:!0,maxWidth:"sm",children:[(0,y.jsx)(b.A,{children:"Payment Details"}),(0,y.jsx)(f.A,{children:(0,y.jsxs)(p.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Payment ID"}),(0,y.jsx)(c.A,{variant:"body2",children:a.id})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Loan ID"}),(0,y.jsx)(c.A,{variant:"body2",children:a.loanId})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Borrower"}),(0,y.jsx)(c.A,{variant:"body2",children:a.borrowerName})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Amount"}),(0,y.jsxs)(c.A,{variant:"h6",children:["$",a.amount.toLocaleString()]})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Payment Date"}),(0,y.jsx)(c.A,{variant:"body2",children:x._J.date(a.paymentDate)})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Status"}),(0,y.jsx)(v.A,{label:a.status,color:"completed"===a.status?"success":"failed"===a.status?"error":"warning",size:"small"})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Type"}),(0,y.jsx)(c.A,{variant:"body2",children:a.type})]}),(0,y.jsxs)(p.Ay,{item:!0,xs:12,md:6,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Method"}),(0,y.jsx)(c.A,{variant:"body2",children:a.method})]}),a.description&&(0,y.jsxs)(p.Ay,{item:!0,xs:12,children:[(0,y.jsx)(c.A,{variant:"caption",color:"text",children:"Description"}),(0,y.jsx)(c.A,{variant:"body2",children:a.description})]})]})}),(0,y.jsxs)(j.A,{children:["completed"===a.status&&(0,y.jsx)(d.A,{variant:"outlined",color:"warning",onClick:()=>l(a),children:"Process Refund"}),"pending"===a.status&&(0,y.jsx)(d.A,{variant:"outlined",color:"error",onClick:()=>s(a),children:"Cancel Payment"}),(0,y.jsx)(d.A,{variant:"contained",onClick:n,children:"Close"})]})]}):null}function z(e){let{open:t,onClose:n,selectedPayments:a,onBulkAction:s}=e;const[i,r]=(0,l.useState)("");return(0,y.jsxs)(A.A,{open:t,onClose:n,maxWidth:"sm",fullWidth:!0,children:[(0,y.jsxs)(b.A,{children:["Bulk Payment Operations (",a.length," payments selected)"]}),(0,y.jsx)(f.A,{children:(0,y.jsxs)(p.Ay,{container:!0,spacing:2,sx:{mt:1},children:[(0,y.jsx)(p.Ay,{item:!0,xs:12,children:(0,y.jsx)(u.$3,{fullWidth:!0,label:"Operation",value:i,onChange:e=>r(e.target.value),options:[{value:"refund",label:"Process Refunds (Completed only)"},{value:"cancel",label:"Cancel Payments (Pending only)"},{value:"delete",label:"Delete Records"}]})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,children:(0,y.jsxs)(c.A,{variant:"caption",color:"text",children:["refund"===i&&"".concat(a.filter(e=>"completed"===e.status).length," completed payments can be refunded."),"cancel"===i&&"".concat(a.filter(e=>"pending"===e.status).length," pending payments can be cancelled."),"delete"===i&&"All ".concat(a.length," payment records will be deleted.")]})})]})}),(0,y.jsxs)(j.A,{children:[(0,y.jsx)(d.A,{variant:"outlined",onClick:n,children:"Cancel"}),(0,y.jsx)(d.A,{variant:"contained",onClick:()=>{const e=a.map(e=>e.id);switch(i){case"refund":const t=a.filter(e=>"completed"===e.status);if(0===t.length)return void alert("No completed payments selected for refund.");window.confirm("Are you sure you want to refund ".concat(t.length," payments?"))&&s("refund",t.map(e=>e.id));break;case"cancel":const n=a.filter(e=>"pending"===e.status);if(0===n.length)return void alert("No pending payments selected for cancellation.");window.confirm("Are you sure you want to cancel ".concat(n.length," payments?"))&&s("cancel",n.map(e=>e.id));break;case"delete":window.confirm("Are you sure you want to delete ".concat(e.length," payment records? This action cannot be undone."))&&s("delete",e)}n()},disabled:!i,children:"Apply"})]})]})}const I=function(){const[e,t]=(0,l.useState)([]),[n,h]=(0,l.useState)(0),[A,b]=(0,l.useState)(!1),[f,j]=(0,l.useState)(""),[I,W]=(0,l.useState)(""),[B,M]=(0,l.useState)(""),[R,T]=(0,l.useState)(""),[_,L]=(0,l.useState)(""),[N,$]=(0,l.useState)(""),[E,F]=(0,l.useState)(""),[J,O]=(0,l.useState)(""),[H,V]=(0,l.useState)(1),[q,G]=(0,l.useState)(10),[K,Q]=(0,l.useState)("paymentDate"),[U,X]=(0,l.useState)("desc"),[Y,Z]=(0,l.useState)([]),[ee,te]=(0,l.useState)(!1),[ne,ae]=(0,l.useState)(null),[le,se]=(0,l.useState)(!1),[ie,re]=(0,l.useState)(!1),[oe,ce]=(0,l.useState)({open:!1,message:"",severity:"success"}),de=function(e){ce({open:!0,message:e,severity:arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success"})},ue=(0,l.useCallback)(async()=>{b(!0);try{const e={page:H,pageSize:q,search:f,status:I,type:B,method:R,dateFrom:_,dateTo:N,amountMin:E?parseFloat(E):void 0,amountMax:J?parseFloat(J):void 0,sortBy:K,sortOrder:U},n=g.A.getPayments(e);t(n.items),h(n.total)}catch(e){de("Error loading payments","error")}finally{b(!1)}},[H,q,f,I,B,R,_,N,E,J,K,U]);(0,l.useEffect)(()=>{ue()},[ue]);const me=async e=>{try{g.A.refundPayments([e.id]).refundedCount>0&&(de("Payment refunded successfully"),se(!1),ue())}catch(t){de("Error processing refund","error")}},pe=async e=>{try{g.A.cancelPayments([e.id]).cancelledCount>0&&(de("Payment cancelled successfully"),se(!1),ue())}catch(t){de("Error cancelling payment","error")}},he=Math.max(1,Math.ceil(n/q)),xe=e=>{switch(e){case"completed":return"success";case"failed":return"error";case"pending":return"warning";case"refunded":return"info";default:return"default"}},ye=e=>{switch(e){case"loan_payment":return"primary";case"fee":return"warning";case"refund":return"info";default:return"default"}};return(0,y.jsxs)(s.A,{children:[(0,y.jsx)(i.A,{}),(0,y.jsxs)(r.A,{children:[(0,y.jsxs)(o.A,{p:3,children:[(0,y.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2,children:[(0,y.jsxs)(o.A,{children:[(0,y.jsx)(c.A,{variant:"h6",children:"Payments Management"}),(0,y.jsxs)(c.A,{variant:"caption",color:"text",children:["Total: ",n," payments | Selected: ",Y.length]})]}),(0,y.jsxs)(o.A,{display:"flex",gap:1,children:[(0,y.jsx)(d.A,{variant:"outlined",onClick:()=>{const t=Y.length?Y:e;g.A.exportCSV("payments",t),de("Exported ".concat(t.length," payments to CSV"))},disabled:!e.length,children:"Export CSV"}),(0,y.jsx)(d.A,{variant:"outlined",onClick:()=>{g.A.exportData("payments"),de("Payments data exported to JSON")},children:"Export JSON"}),Y.length>0&&(0,y.jsxs)(d.A,{variant:"contained",color:"warning",onClick:()=>re(!0),children:["Bulk Actions (",Y.length,")"]})]})]}),(0,y.jsxs)(p.Ay,{container:!0,spacing:2,mb:2,children:[(0,y.jsx)(p.Ay,{item:!0,xs:12,md:2.5,children:(0,y.jsx)(u.RL,{placeholder:"Search payments...",value:f,onChange:e=>{j(e.target.value),V(1)},fullWidth:!0})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1.5,children:(0,y.jsx)(u.$3,{fullWidth:!0,size:"small",label:"Status",value:I,onChange:e=>{W(e.target.value),V(1)},options:[{value:"",label:"All"},{value:"completed",label:"Completed"},{value:"failed",label:"Failed"},{value:"pending",label:"Pending"},{value:"refunded",label:"Refunded"},{value:"cancelled",label:"Cancelled"}]})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1.5,children:(0,y.jsx)(u.$3,{fullWidth:!0,size:"small",label:"Type",value:B,onChange:e=>{M(e.target.value),V(1)},options:[{value:"",label:"All"},{value:"loan_payment",label:"Loan Payment"},{value:"fee",label:"Fee"},{value:"refund",label:"Refund"}]})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1.5,children:(0,y.jsx)(u.$3,{fullWidth:!0,size:"small",label:"Method",value:R,onChange:e=>{T(e.target.value),V(1)},options:[{value:"",label:"All"},{value:"bank_transfer",label:"Bank Transfer"},{value:"card",label:"Card"},{value:"check",label:"Check"},{value:"cash",label:"Cash"}]})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1.5,children:(0,y.jsx)(u.RL,{label:"Date From",type:"date",fullWidth:!0,size:"small",value:_,onChange:e=>{L(e.target.value),V(1)},InputLabelProps:{shrink:!0}})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1.5,children:(0,y.jsx)(u.RL,{label:"Date To",type:"date",fullWidth:!0,size:"small",value:N,onChange:e=>{$(e.target.value),V(1)},InputLabelProps:{shrink:!0}})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1,children:(0,y.jsx)(u.RL,{label:"Min $",type:"number",fullWidth:!0,size:"small",value:E,onChange:e=>{F(e.target.value),V(1)}})}),(0,y.jsx)(p.Ay,{item:!0,xs:12,md:1,children:(0,y.jsx)(u.RL,{label:"Max $",type:"number",fullWidth:!0,size:"small",value:J,onChange:e=>{O(e.target.value),V(1)}})})]}),(0,y.jsxs)(o.A,{display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,y.jsx)(d.A,{variant:"outlined",onClick:()=>{j(""),W(""),M(""),T(""),L(""),$(""),F(""),O(""),V(1)},size:"small",children:"Clear Filters"}),(0,y.jsxs)(o.A,{display:"flex",alignItems:"center",gap:1,children:[(0,y.jsx)(c.A,{variant:"caption",children:"Sort by:"}),(0,y.jsx)(u.$3,{size:"small",value:K,onChange:e=>Q(e.target.value),options:[{value:"paymentDate",label:"Payment Date"},{value:"amount",label:"Amount"},{value:"status",label:"Status"},{value:"type",label:"Type"},{value:"borrowerName",label:"Borrower"}]}),(0,y.jsx)(u.$3,{size:"small",value:U,onChange:e=>X(e.target.value),options:[{value:"asc",label:"Ascending"},{value:"desc",label:"Descending"}]})]})]})]}),(0,y.jsx)(m.A,{columns:[{id:"id",label:"Payment ID",width:120,minWidth:120,align:"left"},{id:"borrowerName",label:"Borrower",width:200,minWidth:150,align:"left"},{id:"amount",label:"Amount",width:140,align:"right",format:e=>x._J.currency(e||0)},{id:"type",label:"Type",width:120,align:"center",format:e=>(0,y.jsx)(v.A,{label:e,color:ye(e),size:"small"})},{id:"method",label:"Method",width:140,align:"left"},{id:"status",label:"Status",width:120,align:"center",format:e=>(0,y.jsx)(v.A,{label:e,color:xe(e),size:"small"})},{id:"paymentDate",label:"Date",width:140,align:"center",format:e=>{const t=e?new Date(e):null;return t&&!isNaN(t.getTime())?x._J.date(t):"\u2014"}},{id:"actions",label:"Actions",width:150,align:"center",format:(e,t)=>(0,y.jsxs)(o.A,{display:"flex",justifyContent:"center",gap:1,children:[(0,y.jsx)(C.A,{size:"small",onClick:()=>{ae(t),se(!0)},children:(0,y.jsx)(w.A,{fontSize:"small",children:"visibility"})}),"completed"===t.status&&(0,y.jsx)(C.A,{size:"small",color:"warning",onClick:()=>me(t),children:(0,y.jsx)(w.A,{fontSize:"small",children:"undo"})}),"pending"===t.status&&(0,y.jsx)(C.A,{size:"small",color:"error",onClick:()=>pe(t),children:(0,y.jsx)(w.A,{fontSize:"small",children:"cancel"})})]})}],data:e,selectedItems:Y,onSelectAll:t=>{te(t),Z(t?[...e]:[])},onSelectItem:(e,t)=>{t?Z([...Y,e]):(Z(Y.filter(t=>t.id!==e.id)),te(!1))},showCheckbox:!0,stickyHeader:!1,maxHeight:"65vh"}),(0,y.jsxs)(o.A,{p:3,display:"flex",justifyContent:"space-between",alignItems:"center",children:[(0,y.jsxs)(o.A,{display:"flex",alignItems:"center",gap:2,children:[(0,y.jsx)(c.A,{variant:"caption",children:"Page size:"}),(0,y.jsx)(u.$3,{size:"small",value:q,onChange:e=>{G(Number(e.target.value)),V(1)},options:[{value:5,label:"5"},{value:10,label:"10"},{value:25,label:"25"},{value:50,label:"50"}]})]}),(0,y.jsx)(P.A,{count:he,page:H,onChange:(e,t)=>V(t),color:"primary"})]}),(0,y.jsx)(D,{open:le,onClose:()=>se(!1),payment:ne,onRefund:me,onCancel:pe}),(0,y.jsx)(z,{open:ie,onClose:()=>re(!1),selectedPayments:Y,onBulkAction:async(e,t)=>{try{let n;switch(e){case"refund":n=g.A.refundPayments(t),de("".concat(n.refundedCount," payments refunded"));break;case"cancel":n=g.A.cancelPayments(t),de("".concat(n.cancelledCount," payments cancelled"));break;case"delete":n=g.A.bulkDeletePayments(t),de("".concat(n.deletedCount," payment records deleted"))}Z([]),te(!1),ue()}catch(n){de("Error performing bulk operation","error")}}}),(0,y.jsx)(S.A,{open:oe.open,autoHideDuration:4e3,onClose:()=>ce((0,a.A)((0,a.A)({},oe),{},{open:!1})),children:(0,y.jsx)(k.A,{severity:oe.severity,onClose:()=>ce((0,a.A)((0,a.A)({},oe),{},{open:!1})),children:oe.message})})]})]})}}}]);
//# sourceMappingURL=207.23ffdf1b.chunk.js.map