"use strict";(self.webpackChunkmaterial_dashboard_2_react=self.webpackChunkmaterial_dashboard_2_react||[]).push([[450,496],{5496:(e,t,n)=>{n.r(t),n.d(t,{approveLoan:()=>d,default:()=>g,denyLoan:()=>l,getAnalytics:()=>u,getAuditLogs:()=>y,getLoans:()=>c,getUsers:()=>o,logAdminAction:()=>h,refundPayment:()=>m,updateUser:()=>r});var a=n(9379);const i={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE||"";async function s(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=i+e;try{const e=await fetch(n,t);if(!e.ok)throw new Error("API ".concat(n," returned ").concat(e.status));return await e.json()}catch(a){return console.warn("adminApi safeFetch failed, falling back to mock:",a.message),null}}async function o(){let{page:e=1,pageSize:t=10,query:n=""}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const i="?page=".concat(e,"&pageSize=").concat(t,"&q=").concat(encodeURIComponent(n)),o=await s("/api/admin/users"+i);if(o)return o;const r=[{id:"user_001",name:"John Doe",email:"john.doe@email.com",status:"active"},{id:"user_002",name:"Jane Smith",email:"jane.smith@email.com",status:"suspended"},{id:"user_003",name:"Alice Park",email:"alice.park@email.com",status:"active"},{id:"user_004",name:"Bob Lee",email:"bob.lee@email.com",status:"active"},{id:"user_005",name:"Carla Gomez",email:"carla.gomez@email.com",status:"active"}],c=Array.from({length:45}).map((e,t)=>r[t%r.length]).map((e,t)=>(0,a.A)((0,a.A)({},e),{},{id:"user_".concat(100+t),name:"".concat(e.name," ").concat(t)})),d=(n||"").toLowerCase(),l=d?c.filter(e=>(e.name||"").toLowerCase().includes(d)||(e.email||"").toLowerCase().includes(d)||(e.id||"").toLowerCase().includes(d)):c,m=l.length,u=(e-1)*t;return{items:l.slice(u,u+t),total:m}}async function r(e,t){const n=await s("/api/admin/users/".concat(e),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});return n||(0,a.A)({id:e},t)}async function c(){const e=await s("/api/admin/loans");return e||[]}async function d(e){const t=await s("/api/admin/loans/".concat(e,"/approve"),{method:"POST"});return t||{id:e,status:"approved"}}async function l(e,t){const n=await s("/api/admin/loans/".concat(e,"/deny"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({reason:t})});return n||{id:e,status:"denied",reason:t}}async function m(e,t){const n=await s("/api/admin/payments/".concat(e,"/refund"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({amount:t})});return n||{paymentId:e,refunded:!0,amount:t}}async function u(){const e=await s("/api/admin/analytics");return e||{totalUsers:1240,activeLoans:320,monthlyPayments:45230,revenue:1234500,paymentsByDay:Array.from({length:30},(e,t)=>({date:"2025-08-".concat(t+1),amount:Math.floor(5e3*Math.random())}))}}async function y(){const e=await s("/api/admin/audit");return e||[{id:"log_001",time:(new Date).toISOString(),admin:"admin_1",action:"approve_loan",details:"loan_101"},{id:"log_002",time:(new Date).toISOString(),admin:"admin_2",action:"refund_payment",details:"payment_202"}]}async function h(e){const t=await s("/api/admin/audit",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});return t||(0,a.A)({id:"log_".concat(Date.now())},e)}const g={getUsers:o,updateUser:r,getLoans:c,approveLoan:d,denyLoan:l,refundPayment:m,getAnalytics:u,getAuditLogs:y,logAdminAction:h}},7450:(e,t,n)=>{n.r(t),n.d(t,{default:()=>O});var a=n(5043),i=n(8903),s=n(2110),o=n(5721),r=n(4628),c=n(8734),d=n(1758),l=n(3404),m=n(1045),u=n(1797),y=n(8961),h=n(6460),g=n(8294),p=n(4),f=n(9379),v=n(5496);const A="drivecash_mock_chats_v1";function x(){try{return JSON.parse(localStorage.getItem(A)||"{}")}catch(e){return{}}}function w(e){localStorage.setItem(A,JSON.stringify(e))}async function S(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{const n=await fetch(e,t);if(!n.ok)throw new Error("bad");return await n.json()}catch(n){return null}}const _={getConversations:async function(){const e=await S("/api/chat/conversations");if(e)return e;const t=x();return Object.values(t).map(e=>({id:e.id,userId:e.userId,unread:e.messages.some(e=>"user"===e.direction&&!e.readByAdmin),lastMessage:e.messages[e.messages.length-1]}))},getMessages:async function(e){var t;const n=await S("/api/chat/".concat(e,"/messages"));return n||((null===(t=x()[e])||void 0===t?void 0:t.messages)||[])},startConversation:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const n=await S("/api/chat/start",{method:"POST",body:JSON.stringify({userId:e,meta:t})});if(n)return n;const a=x(),i="conv_".concat(Date.now());return a[i]={id:i,userId:e,meta:t,messages:[]},w(a),a[i]},sendMessage:async function(e,t){let{text:n,from:a="user"}=t;const i=await S("/api/chat/".concat(e,"/send"),{method:"POST",body:JSON.stringify({text:n,from:a})});if(i)return i;const s=x(),o=s[e]||{id:e,userId:"unknown",messages:[]},r={id:"m_".concat(Date.now()),text:n,time:(new Date).toISOString(),direction:"user"===a?"user":"admin",readByAdmin:"admin"===a,readByUser:"user"===a};return o.messages.push(r),s[e]=o,w(s),"admin"===a&&await v.default.logAdminAction({time:(new Date).toISOString(),admin:"system",action:"admin_message",details:"".concat(e,":").concat(r.id)}),r},markRead:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"admin";const n=await S("/api/chat/".concat(e,"/read"),{method:"POST",body:JSON.stringify({forWhom:t})});if(n)return n;const a=x(),i=a[e];return i?(i.messages=i.messages.map(e=>(0,f.A)((0,f.A)({},e),"admin"===t?{readByAdmin:!0}:{readByUser:!0})),a[e]=i,w(a),!0):null}};var j=n(2744),C=n(7311),b=n(579);function O(){const[e,t]=(0,a.useState)([]),[n,f]=(0,a.useState)(null),[v,A]=(0,a.useState)([]),[x,w]=(0,a.useState)(""),S=(0,a.useRef)(null);async function O(){if(!n||!x.trim())return;const e=await _.sendMessage(n.id,{text:x.trim(),from:"admin"});A(t=>[...t,{id:e.id,text:e.text||e.message||x.trim(),direction:"admin",time:e.time||(new Date).toISOString()}]),w(""),j.Ay.emitMessage(n.id,{id:e.id,text:e.text||e.message||x.trim(),from:"admin"});const a=await _.getConversations();t(a||[])}return(0,a.useEffect)(()=>{let e=!0;!async function(){const n=await _.getConversations();e&&t(n||[])}();const a=j.Ay.onSocketMessage(e=>{e&&e.conversationId&&e.message&&(n&&e.conversationId===n.id&&A(t=>[...t,{id:"socket_".concat(Date.now()),text:e.message.text||e.message,direction:"user",time:(new Date).toISOString()}]),_.getConversations().then(e=>t(e||[])))});return()=>{e=!1,a&&a()}},[n]),(0,a.useEffect)(()=>{!function(){try{var e;null===(e=S.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})}catch(t){}}()},[v]),(0,b.jsxs)(h.A,{children:[(0,b.jsx)(g.A,{}),(0,b.jsxs)(u.A,{py:3,children:[(0,b.jsx)(y.A,{variant:"h4",fontWeight:"bold",mb:1,children:"Admin Chat Inbox"}),(0,b.jsxs)(i.Ay,{container:!0,spacing:3,children:[(0,b.jsx)(i.Ay,{item:!0,xs:12,md:4,children:(0,b.jsxs)(s.A,{sx:{p:2,height:"600px",overflowY:"auto"},children:[(0,b.jsx)(y.A,{variant:"h6",children:"Conversations"}),(0,b.jsxs)(o.A,{children:[0===e.length&&(0,b.jsx)(r.Ay,{children:(0,b.jsx)(c.A,{primary:"No conversations"})}),e.map(e=>{var t,a;return(0,b.jsxs)(r.Ay,{button:!0,selected:(null===n||void 0===n?void 0:n.id)===e.id,onClick:()=>async function(e){f(e);const t=await _.getMessages(e.id);A(t||[]),_.markRead(e.id,"admin").catch(()=>{})}(e),children:[(0,b.jsx)(m.A,{sx:{mr:2},children:String(e.userId||"U").charAt(0)}),(0,b.jsx)(c.A,{primary:e.userId||e.id,secondary:(null===(t=e.lastMessage)||void 0===t?void 0:t.text)||(null===(a=e.lastMessage)||void 0===a?void 0:a.message)&&e.lastMessage.message||"\u2014"})]},e.id)})]})]})}),(0,b.jsx)(i.Ay,{item:!0,xs:12,md:8,children:(0,b.jsxs)(s.A,{sx:{p:2,height:"600px",display:"flex",flexDirection:"column"},children:[(0,b.jsx)(y.A,{variant:"h6",children:n?"Conversation: ".concat(n.id):"Select a conversation"}),(0,b.jsxs)(u.A,{sx:{flex:1,overflowY:"auto",my:2,p:1,borderRadius:1,backgroundColor:"#fafafa"},children:[v.map(e=>(0,b.jsx)(u.A,{display:"flex",justifyContent:"admin"===e.direction?"flex-end":"flex-start",mb:1,children:(0,b.jsxs)(u.A,{bgcolor:"admin"===e.direction?"primary.main":"grey.200",color:"admin"===e.direction?"white":"text.primary",px:2,py:1,borderRadius:2,maxWidth:"70%",children:[(0,b.jsx)(y.A,{variant:"body2",children:e.text}),(0,b.jsx)(y.A,{variant:"caption",display:"block",mt:.5,children:new Date(e.time).toLocaleString()})]})},e.id)),(0,b.jsx)("div",{ref:S})]}),(0,b.jsxs)(u.A,{display:"flex",gap:1,alignItems:"center",children:[(0,b.jsx)(d.XC,{fullWidth:!0,multiline:!0,maxRows:4,minRows:1,placeholder:"Type a reply...",value:x,onChange:e=>w(e.target.value),onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),O())}}),(0,b.jsx)(l.A,{variant:"contained",color:"primary",onClick:O,children:"Send"}),(0,b.jsx)(l.A,{variant:"outlined",color:"success",onClick:async function(){if(!n)return;await _.markResolved(n.id,"admin");try{C.A.incrementResolvedCount("admin_user",1)}catch(a){}try{await fetch("/api/push/send",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({conversationId:n.id,payload:{title:"Conversation resolved",body:"Your support conversation ".concat(n.id," was resolved by admin.")}})})}catch(a){console.warn("push/send failed",a)}const e=await _.getConversations();t(e||[]),f(null),A([])},disabled:!n,children:"Resolve"})]})]})})]})]}),(0,b.jsx)(p.A,{})]})}}}]);
//# sourceMappingURL=450.7d28692d.chunk.js.map